{% extends "base.html" %}
{% load static %}

{% block content %}
<script src="https://js.stripe.com/v3/"></script>

<div class="container my-5">
    <h2 class="mb-4">Secure Payment</h2>

    <div class="card p-4">
        <form id="payment-form">
            {% csrf_token %}

            <!-- Stripe renders card / wallet UI here -->
            <div id="payment-element" style="min-height: 120px;" class="mb-3"></div>

            <button id="submit" class="btn btn-success btn-block mt-4">
                Pay Now
            </button>
            <div id="error-message" class="text-danger mt-3"></div>
        </form>
    </div>
</div>

<script>
const stripe = Stripe("{{ stripe_public_key }}");

const elements = stripe.elements({
    clientSecret: "{{ client_secret }}"
});

const paymentElement = elements.create("payment");
paymentElement.mount("#payment-element");

const form = document.getElementById("payment-form");

form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const { error } = await stripe.confirmPayment({
        elements,
        confirmParams: {
            return_url: "{{ site_url }}{% url 'payment:payment_success' %}",
        },
    });

    if (error) {
        document.getElementById("error-message").textContent = error.message;
    }
});
</script>
{% endblock %}
